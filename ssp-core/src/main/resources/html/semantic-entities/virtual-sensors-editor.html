<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8" />
    <title>Virtual Sensors Editor</title>
    <link href="../../style/css/semantic.css" rel="stylesheet" type="text/css" />
    <link href="../../style/css/semantic.min.css" rel="stylesheet" type="text/css"/>
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Open+Sans:300italic,400,300,700'
          rel='stylesheet' type='text/css'>

    <style type="text/css">
        :not(i){
            font-family: 'Open Sans', sans-serif;
        }

        *{
            font-size: 13px;
        }
    </style>

    <script src="../../style/javascript/jquery-1.11.1.min.js"></script>

</head>

<body>
<div class="ui one column page grid">
    <div class="column">
        <div id="header">
        </div>
        <script src="../../style/javascript/ssp-menu.js"></script>

        <h4 class="ui top attached header">
            List of Virtual Sensors
        </h4>

        <div class="ui form segment attached">
            <table class="ui basic table">
                <thead>
                    <tr>
                        <th>Sensor Name</th>
                        <th>Sensor Output</th>
                        <th>Edit</th>
                    </tr>
                </thead>
                <tbody id="virtualSensors">
                </tbody>
            </table>
        </div>
    </div>
</div>


<script>
    $(document).ready(function(){

        var formData = new FormData();
        //formData.append('query', 'SELECT DISTINCT ?g WHERE { GRAPH ?g {?s ?p ?o} } ORDER BY ASC(?g)');
        formData.append('query', '' +
        'PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\n' +
        'PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n' +
        'PREFIX vs: <http://example.org/virtual-sensors#>\n' +
        'PREFIX ssn: <http://purl.oclc.org/NET/ssnx/ssn#>\n' +
        'SELECT DISTINCT ?s ?r WHERE {\n' +
        '  ?s rdf:type ?t .\n' +
        '  ?t rdfs:subClassOf vs:VirtualSensor .\n' +
        '  ?o ssn:observedBy ?s .' +
        '  ?o ssn:observedResult ?r' +
        '} ORDER BY ASC(?s)');

        $.ajax({
            type: "POST",
            beforeSend: function (request)
            {
                request.setRequestHeader("Accept", 'application/sparql-results+json');
            },
            url: '/services/sparql-endpoint',
            data: formData,
            dataType: 'text',
            contentType: false,
            processData: false,
            success: function(e){
                var parsedJSON = JSON.parse(e);
                var seListContent = '';
                parsedJSON['results']['bindings'].forEach(function(graph){
                    var vSensorName = graph['s']['value'];
                    var vSensorResult = graph['r']['value'];
                    seListContent += '<tr>\
                            <td><a href="/?resource=' + encodeURIComponent(vSensorName) + '">' + vSensorName + '</a></td>\
                            <td><a href="/?resource=' + encodeURIComponent(vSensorResult) + '">' + vSensorResult + '</a></td>\
                            <td>\
                                <div class="ui small icon button"><i class="edit icon"></i></div>\
                                <div class="ui small red icon button"><i class="trash icon"></i></div>\
                            </td></tr>\n';
                });
                $('#virtualSensors').html(seListContent);
            },
            error: function(e){
                console.log('ERROR!' + e);
            }
        });
    });
</script>
</body>
</html>